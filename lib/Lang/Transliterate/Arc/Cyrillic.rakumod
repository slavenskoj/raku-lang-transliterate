use Lang::Transliterate;

unit class Lang::Transliterate::Arc::Cyrillic does Lang::Transliterate::Transliterator;

# Imperial Aramaic to Cyrillic Script Conversion
# Based on the Wikipedia comparison table and Cyrillic derivation from Greek

my %base-mappings = (
    # Imperial Aramaic to Cyrillic mappings
    "\c[0x10840]" => "\c[0x0410]",   # ğ¡€ Aleph â†’ Ğ A
    "\c[0x10841]" => "\c[0x0411]",   # ğ¡ Beth â†’ Ğ‘ B (also Ğ’ V)
    "\c[0x10842]" => "\c[0x0413]",   # ğ¡‚ Gamal â†’ Ğ“ G (also Ò Ò)
    "\c[0x10843]" => "\c[0x0414]",   # ğ¡ƒ Dalath â†’ Ğ” D
    "\c[0x10844]" => "\c[0x0415]",   # ğ¡„ He â†’ Ğ• E (also Ğ„ Ğ„, Ğ Ğ, Ğ­ Ğ­)
    "\c[0x10845]" => "\c[0x0423]",   # ğ¡… Waw â†’ Ğ£ U (also Ğ Ğ, Ñ´ Ñ´)
    "\c[0x10846]" => "\c[0x0417]",   # ğ¡† Zayn â†’ Ğ— Z
    "\c[0x10847]" => "\c[0x0418]",   # ğ¡‡ Heth â†’ Ğ˜ I (also Ğ™ Ğ™)
    "\c[0x10848]" => "\c[0x0424]",   # ğ¡ˆ Teth â†’ Ğ¤ F (also archaic Ñ² Ñ²)
    "\c[0x10849]" => "\c[0x0406]",   # ğ¡‰ Yodh â†’ Ğ† I (also Ğ‡ Ğ‡, Ğˆ Ğˆ)
    "\c[0x1084A]" => "\c[0x041A]",   # ğ¡Š Kaph â†’ Ğš K
    "\c[0x1084B]" => "\c[0x041B]",   # ğ¡‹ Lamadh â†’ Ğ› L
    "\c[0x1084C]" => "\c[0x041C]",   # ğ¡Œ Mim â†’ Ğœ M
    "\c[0x1084D]" => "\c[0x041D]",   # ğ¡ Nun â†’ Ğ N
    "\c[0x1084E]" => "\c[0x046E]",   # ğ¡ Semkath â†’ Ñ® Ksi (archaic)
    "\c[0x1084F]" => "\c[0x041E]",   # ğ¡ Ayn â†’ Ğ O (also Ñ  Ñ  omega)
    "\c[0x10850]" => "\c[0x041F]",   # ğ¡ Pe â†’ ĞŸ P
    "\c[0x10851]" => "\c[0x0426]",   # ğ¡‘ Sadhe â†’ Ğ¦ C (also Ğ§ Ğ§, Ğ Ğ)
    "\c[0x10852]" => "\c[0x0424]",   # ğ¡’ Qoph â†’ Ğ¤ F (archaic Ò€ Ò€)
    "\c[0x10853]" => "\c[0x0420]",   # ğ¡“ Resh â†’ Ğ  R
    "\c[0x10854]" => "\c[0x0421]",   # ğ¡” Shin â†’ Ğ¡ S (also Ğ¨ Ğ¨, Ğ© Ğ©)
    "\c[0x10855]" => "\c[0x0422]",   # ğ¡• Taw â†’ Ğ¢ T
);

method get-mappings(--> Hash) {
    return %base-mappings;
}

method get-reverse-mappings(--> List) {
    # Cyrillic to Imperial Aramaic reverse mappings
    return (
        "\c[0x0410]" => "\c[0x10840]",   # Ğ â†’ ğ¡€
        "\c[0x0430]" => "\c[0x10840]",   # Ğ° â†’ ğ¡€
        "\c[0x0411]" => "\c[0x10841]",   # Ğ‘ â†’ ğ¡
        "\c[0x0431]" => "\c[0x10841]",   # Ğ± â†’ ğ¡
        "\c[0x0412]" => "\c[0x10841]",   # Ğ’ â†’ ğ¡ (also from beth)
        "\c[0x0432]" => "\c[0x10841]",   # Ğ² â†’ ğ¡
        "\c[0x0413]" => "\c[0x10842]",   # Ğ“ â†’ ğ¡‚
        "\c[0x0433]" => "\c[0x10842]",   # Ğ³ â†’ ğ¡‚
        "\c[0x0490]" => "\c[0x10842]",   # Ò â†’ ğ¡‚
        "\c[0x0491]" => "\c[0x10842]",   # Ò‘ â†’ ğ¡‚
        "\c[0x0414]" => "\c[0x10843]",   # Ğ” â†’ ğ¡ƒ
        "\c[0x0434]" => "\c[0x10843]",   # Ğ´ â†’ ğ¡ƒ
        "\c[0x0415]" => "\c[0x10844]",   # Ğ• â†’ ğ¡„
        "\c[0x0435]" => "\c[0x10844]",   # Ğµ â†’ ğ¡„
        "\c[0x0401]" => "\c[0x10844]",   # Ğ â†’ ğ¡„
        "\c[0x0451]" => "\c[0x10844]",   # Ñ‘ â†’ ğ¡„
        "\c[0x0404]" => "\c[0x10844]",   # Ğ„ â†’ ğ¡„
        "\c[0x0454]" => "\c[0x10844]",   # Ñ” â†’ ğ¡„
        "\c[0x042D]" => "\c[0x10844]",   # Ğ­ â†’ ğ¡„
        "\c[0x044D]" => "\c[0x10844]",   # Ñ â†’ ğ¡„
        "\c[0x0423]" => "\c[0x10845]",   # Ğ£ â†’ ğ¡…
        "\c[0x0443]" => "\c[0x10845]",   # Ñƒ â†’ ğ¡…
        "\c[0x040E]" => "\c[0x10845]",   # Ğ â†’ ğ¡…
        "\c[0x045E]" => "\c[0x10845]",   # Ñ â†’ ğ¡…
        "\c[0x0474]" => "\c[0x10845]",   # Ñ´ â†’ ğ¡…
        "\c[0x0475]" => "\c[0x10845]",   # Ñµ â†’ ğ¡…
        "\c[0x0417]" => "\c[0x10846]",   # Ğ— â†’ ğ¡†
        "\c[0x0437]" => "\c[0x10846]",   # Ğ· â†’ ğ¡†
        "\c[0x0418]" => "\c[0x10847]",   # Ğ˜ â†’ ğ¡‡
        "\c[0x0438]" => "\c[0x10847]",   # Ğ¸ â†’ ğ¡‡
        "\c[0x0419]" => "\c[0x10847]",   # Ğ™ â†’ ğ¡‡
        "\c[0x0439]" => "\c[0x10847]",   # Ğ¹ â†’ ğ¡‡
        "\c[0x0424]" => "\c[0x10848]",   # Ğ¤ â†’ ğ¡ˆ (also qoph)
        "\c[0x0444]" => "\c[0x10848]",   # Ñ„ â†’ ğ¡ˆ
        "\c[0x0472]" => "\c[0x10848]",   # Ñ² â†’ ğ¡ˆ (archaic theta)
        "\c[0x0473]" => "\c[0x10848]",   # Ñ³ â†’ ğ¡ˆ
        "\c[0x0406]" => "\c[0x10849]",   # Ğ† â†’ ğ¡‰
        "\c[0x0456]" => "\c[0x10849]",   # Ñ– â†’ ğ¡‰
        "\c[0x0407]" => "\c[0x10849]",   # Ğ‡ â†’ ğ¡‰
        "\c[0x0457]" => "\c[0x10849]",   # Ñ— â†’ ğ¡‰
        "\c[0x0408]" => "\c[0x10849]",   # Ğˆ â†’ ğ¡‰
        "\c[0x0458]" => "\c[0x10849]",   # Ñ˜ â†’ ğ¡‰
        "\c[0x041A]" => "\c[0x1084A]",   # Ğš â†’ ğ¡Š
        "\c[0x043A]" => "\c[0x1084A]",   # Ğº â†’ ğ¡Š
        "\c[0x041B]" => "\c[0x1084B]",   # Ğ› â†’ ğ¡‹
        "\c[0x043B]" => "\c[0x1084B]",   # Ğ» â†’ ğ¡‹
        "\c[0x041C]" => "\c[0x1084C]",   # Ğœ â†’ ğ¡Œ
        "\c[0x043C]" => "\c[0x1084C]",   # Ğ¼ â†’ ğ¡Œ
        "\c[0x041D]" => "\c[0x1084D]",   # Ğ â†’ ğ¡
        "\c[0x043D]" => "\c[0x1084D]",   # Ğ½ â†’ ğ¡
        "\c[0x046E]" => "\c[0x1084E]",   # Ñ® â†’ ğ¡
        "\c[0x046F]" => "\c[0x1084E]",   # Ñ¯ â†’ ğ¡
        "\c[0x041E]" => "\c[0x1084F]",   # Ğ â†’ ğ¡
        "\c[0x043E]" => "\c[0x1084F]",   # Ğ¾ â†’ ğ¡
        "\c[0x0460]" => "\c[0x1084F]",   # Ñ  â†’ ğ¡ (omega)
        "\c[0x0461]" => "\c[0x1084F]",   # Ñ¡ â†’ ğ¡
        "\c[0x041F]" => "\c[0x10850]",   # ĞŸ â†’ ğ¡
        "\c[0x043F]" => "\c[0x10850]",   # Ğ¿ â†’ ğ¡
        "\c[0x0426]" => "\c[0x10851]",   # Ğ¦ â†’ ğ¡‘
        "\c[0x0446]" => "\c[0x10851]",   # Ñ† â†’ ğ¡‘
        "\c[0x0427]" => "\c[0x10851]",   # Ğ§ â†’ ğ¡‘
        "\c[0x0447]" => "\c[0x10851]",   # Ñ‡ â†’ ğ¡‘
        "\c[0x040F]" => "\c[0x10851]",   # Ğ â†’ ğ¡‘
        "\c[0x045F]" => "\c[0x10851]",   # ÑŸ â†’ ğ¡‘
        "\c[0x0480]" => "\c[0x10852]",   # Ò€ â†’ ğ¡’ (archaic qoppa)
        "\c[0x0481]" => "\c[0x10852]",   # Ò â†’ ğ¡’
        "\c[0x0420]" => "\c[0x10853]",   # Ğ  â†’ ğ¡“
        "\c[0x0440]" => "\c[0x10853]",   # Ñ€ â†’ ğ¡“
        "\c[0x0421]" => "\c[0x10854]",   # Ğ¡ â†’ ğ¡”
        "\c[0x0441]" => "\c[0x10854]",   # Ñ â†’ ğ¡”
        "\c[0x0428]" => "\c[0x10854]",   # Ğ¨ â†’ ğ¡”
        "\c[0x0448]" => "\c[0x10854]",   # Ñˆ â†’ ğ¡”
        "\c[0x0429]" => "\c[0x10854]",   # Ğ© â†’ ğ¡”
        "\c[0x0449]" => "\c[0x10854]",   # Ñ‰ â†’ ğ¡”
        "\c[0x0422]" => "\c[0x10855]",   # Ğ¢ â†’ ğ¡•
        "\c[0x0442]" => "\c[0x10855]",   # Ñ‚ â†’ ğ¡•
    );
}

# Cyrillic uses vowels as separate letters, so we need to strip them when converting back
method detransliterate-context-aware(Str $text, :%reverse-mappings = self.get-reverse-mappings().Hash --> Str) {
    # Strip all Cyrillic vowels (Ğ, Ğ•, Ğ, Ğ˜, Ğ†, Ğ, Ğ£, Ğ«, Ğ­, Ğ®, Ğ¯ and their variants)
    my $consonantal = $text.subst(/<[\c[0x0410]\c[0x0430]\c[0x0415]\c[0x0435]\c[0x0401]\c[0x0451]\c[0x0418]\c[0x0438]\c[0x0406]\c[0x0456]\c[0x0407]\c[0x0457]\c[0x041E]\c[0x043E]\c[0x0423]\c[0x0443]\c[0x042B]\c[0x044B]\c[0x042D]\c[0x044D]\c[0x042E]\c[0x044E]\c[0x042F]\c[0x044F]\c[0x0404]\c[0x0454]\c[0x040E]\c[0x045E]\c[0x0474]\c[0x0475]\c[0x0460]\c[0x0461]]>/, '', :g);
    
    # Then apply the standard detransliteration
    return self.detransliterate($consonantal, :%reverse-mappings);
}